<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¥½æ¼æ—¥ Mahimahi Todayï½œé¬¼é ­åˆ€é­šæ–™ç†</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

body{
  font-family:'Noto Sans TC',sans-serif;
  background: linear-gradient(to bottom,#0ea5e9,#e0f7ff);
  overflow-x:hidden;
}

/* æµ·æµªå‹•ç•« */
.wave{
  position:fixed;
  bottom:0;
  left:0;
  width:200%;
  height:120px;
  background:rgba(255,255,255,0.25);
  border-radius:43%;
  animation:waveMove 12s linear infinite;
}
.wave:nth-child(2){
  bottom:10px;
  opacity:0.5;
  animation-duration:18s;
}
@keyframes waveMove{
  from{transform:translateX(0);}
  to{transform:translateX(-50%);}
}

/* é­šç¾¤å‹•ç•« */
.fish{
  position:fixed;
  top:20%;
  font-size:40px;
  animation:fishSwim 25s linear infinite;
  opacity:0.15;
}
@keyframes fishSwim{
  from{transform:translateX(-10%);}
  to{transform:translateX(110vw);}
}

.category-btn.active{
  background:#0284c7;
  color:white;
}

.glass-card{
  backdrop-filter: blur(8px);
  background: rgba(255,255,255,0.75);
  border:1px solid rgba(255,255,255,0.6);
}
</style>
</head>

<body class="pb-20">

<div class="fish">ğŸŸ ğŸŸ ğŸ  ğŸ¡</div>
<div class="wave"></div>
<div class="wave"></div>

<header class="bg-sky-700 text-white p-4 shadow-xl sticky top-0 z-50">
<div class="container mx-auto flex justify-between items-center">
<h1 class="text-2xl font-black tracking-wider">
ğŸŸ å¥½æ¼æ—¥ Mahimahi Today
</h1>

<div class="flex items-center gap-6 flex-grow justify-center">
<div class="text-lg bg-white/20 px-4 py-1 rounded-full scale-110">
æ¡Œè™Ÿï¼š<span id="table-no">-</span>
</div>

<div onclick="toggleCart()" class="relative cursor-pointer flex items-center gap-2 scale-110">
<span class="hidden md:inline font-bold">è³¼ç‰©è»Š</span>
<i class="fas fa-shopping-cart text-2xl"></i>
<span id="cart-count" class="absolute -top-2 -right-2 bg-yellow-300 text-blue-900 text-xs font-bold px-1.5 py-0.5 rounded-full">0</span>
</div>
</div>

<div class="w-10"></div>
</div>
</header>

<!-- å…¬å‘Š -->
<div class="bg-white/60 backdrop-blur text-center py-3 font-bold text-sky-800">
<span id="marquee-info">æ­¡è¿å…‰è‡¨é¬¼é ­åˆ€é­šæ–™ç†å°ˆé–€åº— ğŸŸ</span>
</div>

<nav id="category-nav" class="sticky top-[78px] bg-white/70 backdrop-blur border-b overflow-x-auto whitespace-nowrap z-40 px-4 py-3 flex gap-2">
<button onclick="filterMenu('all')" class="category-btn active px-4 py-1.5 rounded-full border text-sm">å…¨éƒ¨</button>
</nav>

<main class="container mx-auto p-4">
<div id="loading-spinner" class="text-center py-20 text-white">
<i class="fas fa-spinner fa-spin text-4xl mb-2"></i>
<p>æ­£åœ¨è¼‰å…¥æµ·å‘³æ–™ç†...</p>
</div>

<div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</main>

<!-- è³¼ç‰©è»Š -->
<div id="cart-sidebar" class="fixed inset-y-0 right-0 w-80 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-[60] flex flex-col">
<div class="p-4 border-b flex justify-between items-center bg-sky-700 text-white">
<h3 class="font-bold text-xl">ğŸ§º å·²é¸æµ·å‘³</h3>
<button onclick="toggleCart()" class="text-white text-2xl">&times;</button>
</div>
<div id="cart-items" class="flex-grow overflow-y-auto p-4 space-y-4"></div>
<div class="p-4 border-t bg-gray-50">
<div class="flex justify-between mb-4">
<span class="font-bold">ç¸½è¨ˆï¼š</span>
<span class="text-sky-700 font-bold text-xl" id="total-price">$0</span>
</div>
<button id="btn-submit" onclick="submitOrder()" class="w-full bg-sky-600 text-white py-3 rounded-lg font-bold hover:bg-sky-700">
é€å‡ºè¨‚å–®
</button>
</div>
</div>

<div id="overlay" onclick="toggleCart()" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50"></div>

<script>
const GAS_API_URL="https://script.google.com/macros/s/AKfycbyXw6L_72xAE08U6-hRJm0S52cNCT4NliKGlAmRn5Ya361xfDGhG8d59jZmXqFNsNBt/exec";

let menuData=[];
let cart=[];
let TABLE_NO="";

async function postData(payload){
const res=await fetch(GAS_API_URL,{
method:"POST",
headers:{ "Content-Type":"text/plain;charset=utf-8" },
body:JSON.stringify(payload)
});
return await res.json();
}

async function fetchMenu(){
const res=await fetch(`${GAS_API_URL}?action=getMenu`);
const result=await res.json();
if(result.ok){
menuData=result.data;
renderCats();
displayMenu('all');
document.getElementById('loading-spinner').style.display='none';
}
}

function renderCats(){
const nav=document.getElementById('category-nav');
const cats=[...new Set(menuData.map(i=>i.category))];
cats.forEach(c=>{
const b=document.createElement('button');
b.className="category-btn px-4 py-1.5 rounded-full border text-sm";
b.innerText=c;
b.onclick=()=>filterMenu(c);
nav.appendChild(b);
});
}

function displayMenu(f){
const container=document.getElementById('menu-container');
container.innerHTML='';
const items=f==='all'?menuData:menuData.filter(i=>i.category===f);

items.forEach(i=>{
const cartItem=cart.find(c=>c.name===i.name);
const qty=cartItem?cartItem.qty:0;

const card=document.createElement('div');
card.className="glass-card rounded-2xl p-5 shadow-xl flex justify-between items-center";
card.innerHTML=`
<div class="flex-grow">
<span class="text-xs bg-sky-100 text-sky-700 px-2 py-0.5 rounded">${i.category}</span>
<h3 class="font-black mt-1 text-lg text-sky-800">${i.name}</h3>
<p class="text-xs text-gray-500">${i.desc}</p>
<p class="text-sky-700 font-bold mt-2 text-lg">$${i.price}</p>
</div>
<div class="flex items-center gap-3 bg-white p-1.5 rounded-full border">
<button onclick="removeFromCart(this,'${i.name}')" class="bg-gray-100 w-8 h-8 rounded-full">-</button>
<span class="qty-display font-bold min-w-[20px] text-center">${qty}</span>
<button onclick="addToCart(this,'${i.name}')" class="bg-sky-600 text-white w-8 h-8 rounded-full">+</button>
</div>`;
container.appendChild(card);
});
}

function addToCart(btn,name){
const itemInfo=menuData.find(m=>m.name===name);
let cartItem=cart.find(c=>c.name===name);
if(cartItem){cartItem.qty++;}else{cartItem={...itemInfo,qty:1};cart.push(cartItem);}
btn.parentElement.querySelector('.qty-display').innerText=cartItem.qty;
updateUI();
}

function removeFromCart(btn,name){
const idx=cart.findIndex(c=>c.name===name);
let finalQty=0;
if(idx>-1){
cart[idx].qty--;
finalQty=cart[idx].qty;
if(cart[idx].qty<=0)cart.splice(idx,1);
}
btn.parentElement.querySelector('.qty-display').innerText=finalQty;
updateUI();
}

function updateUI(){
const list=document.getElementById('cart-items');
list.innerHTML=cart.length?'':'<p class="text-gray-400 text-center py-10">å°šæœªé¸æ“‡é¤é»</p>';
let total=0,count=0;
cart.forEach(c=>{
total+=c.price*c.qty;
count+=c.qty;
list.innerHTML+=`
<div class="flex justify-between items-center text-sm border-b pb-2">
<div>
<div class="font-bold">${c.name}</div>
<div class="text-gray-500">$${c.price} x ${c.qty}</div>
</div>
<span class="font-bold text-sky-700">$${c.price*c.qty}</span>
</div>`;
});
document.getElementById('cart-count').innerText=count;
document.getElementById('total-price').innerText=`$${total}`;
}

async function submitOrder(){
if(!TABLE_NO)return alert("è«‹ç”±æ¡Œä¸Š QR Code é€²å…¥ç³»çµ±");
if(!cart.length)return alert("è«‹å…ˆé¸æ“‡é¤é»");
const btn=document.getElementById('btn-submit');
btn.disabled=true;btn.innerText="å‚³é€ä¸­...";
try{
const res=await postData({action:"submitOrder",table:TABLE_NO,items:cart});
if(res.ok){
alert("è¨‚å–®å·²é€å‡ºï¼è«‹ç¨å€™é¬¼é ­åˆ€æ–™ç† ğŸŸ");
cart=[];
updateUI();
displayMenu('all');
toggleCart();
}
}catch(e){alert("é€£ç·šå¤±æ•—");}
btn.disabled=false;btn.innerText="é€å‡ºè¨‚å–®";
}

function toggleCart(){
document.getElementById('cart-sidebar').classList.toggle('translate-x-full');
document.getElementById('overlay').classList.toggle('hidden');
}

function filterMenu(c){
document.querySelectorAll('.category-btn').forEach(b=>{
b.classList.toggle('active',b.innerText===c||(c==='all'&&b.innerText==='å…¨éƒ¨'));
});
displayMenu(c);
}

window.onload=()=>{
TABLE_NO=new URLSearchParams(window.location.search).get('table')||"";
document.getElementById('table-no').innerText=TABLE_NO||"é«”é©—æ¡Œ";
fetchMenu();
};
</script>
</body>
</html>
